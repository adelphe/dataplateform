# OpenMetadata dbt Metadata Ingestion Configuration
# Ingests dbt models, lineage, and documentation

source:
  type: DBT
  serviceName: dbt-transformations
  serviceConnection:
    config:
      type: DBT
      # dbt artifacts location (generated by dbt docs generate)
      dbtConfigSource:
        dbtCatalogFilePath: /opt/airflow/transformations/dbt_project/target/catalog.json
        dbtManifestFilePath: /opt/airflow/transformations/dbt_project/target/manifest.json
        dbtRunResultsFilePath: /opt/airflow/transformations/dbt_project/target/run_results.json
      # Alternative: dbt Cloud configuration
      # dbtCloudUrl: https://cloud.getdbt.com
      # dbtCloudAccountId: "12345"
      # dbtCloudApiToken: ${DBT_CLOUD_API_TOKEN}
      # dbtCloudProjectId: "67890"
  sourceConfig:
    config:
      type: DBTSource
      # Link dbt models to existing database tables
      databaseServiceName: data-warehouse-postgres
      # Parse descriptions and tags from dbt
      includeTags: true
      # Process dbt tests as data quality rules
      includeDBTTests: true
      # Include compiled SQL
      includeCompiledCode: true
      # Skip non-materialized models (ephemeral)
      skipEphemeralNodes: true
      # Parse model schema for column-level metadata
      parsingTimeoutLimit: 300
      # Filter patterns for models
      dbtFilterPattern:
        includes:
          - ".*"
        excludes:
          - "^_.*"

sink:
  type: metadata-rest
  config: {}

workflowConfig:
  loggerLevel: INFO
  openMetadataServerConfig:
    hostPort: http://openmetadata-server:8585/api
    # Authentication: use 'no-auth' for local development, 'basic' for production
    authProvider: ${OPENMETADATA_AUTH_PROVIDER:-basic}
    # Security config with JWT token (used when authProvider is 'basic')
    securityConfig:
      jwtToken: ${OPENMETADATA_JWT_TOKEN:-}
